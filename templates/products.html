{% extends 'base.html' %}
{% block title %}محصولات - رایحه ی حیات{% endblock %}

{% block extra_css %}
<style>
  .products-banner {
    position: relative;
    background: url('https://img.freepik.com/free-photo/black-matte-perfume-bottle-pedestal-with-smoke-dark-background_176474-9817.jpg') no-repeat center center/cover;
    height: 50vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
  }
  .products-banner::before {
    content: "";
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
  }
  .products-banner h1 {
    position: relative;
    z-index: 2;
    font-size: 3rem;
    font-weight: bold;
  }
  .category-buttons {
    text-align: center;
    margin: 2rem 0;
  }
  .category-buttons .btn {
    margin: 5px;
    font-size: 1rem;
    font-weight: bold;
    border-radius: 20px;
    padding: 8px 16px;
  }
  .product-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
  }
  .product-card {
    border: none;
    overflow: hidden;
    border-radius: 10px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    width: 100%;
    max-width: 300px;
    margin: 15px;
  }
  .product-card:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }
  .product-card img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }
  .card-body {
    background: #fff;
    text-align: center;
    padding: 12px;
  }
  .search-container {
    max-width: 400px;
    margin: auto;
  }
</style>
{% endblock %}

{% block content %}
<section class="products-banner">
  <h1>محصولات ما</h1>
</section>

<section class="container category-buttons">
  <button class="btn btn-outline-warning filter-btn" data-filter="all">همه محصولات</button>
  {% for category in products|groupby('category') %}
    <button class="btn btn-outline-warning filter-btn" data-filter="{{ category.grouper }}">{{ category.grouper }}</button>
  {% endfor %}
</section>

<div class="search-container text-center my-4">
  <input type="text" id="productSearch" class="form-control" placeholder="جستجوی محصول...">
</div>

<div class="container">
  {% for category, items in products|groupby('category') %}
    <h3 class="mt-4">{{ category }}</h3>
    <div class="row product-list">
      {% for product in items %}
      <div class="col-md-4">
        <div class="card product-card" data-name="{{ product.name }}" data-category="{{ product.category }}">
          <img src="{{ product.image_url }}" alt="{{ product.name }}">
          <div class="card-body">
            <h5>{{ product.name }}</h5>
            <p>{{ product.scent }}</p>
            <a href="{{ url_for('product_details', product_id=product.id) }}" class="btn btn-warning btn-sm">جزئیات</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% endfor %}
</div>

<script>
  // جستجو
  document.getElementById('productSearch').addEventListener('keyup', function(){
    let filter = this.value.toLowerCase();
    let products = document.querySelectorAll('.product-card');
    products.forEach(function(product){
      let productName = product.getAttribute('data-name').toLowerCase();
      if(productName.includes(filter)){
        product.style.display = 'block';
      } else {
        product.style.display = 'none';
      }
    });
  });

  // فیلتر
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', function(){
      let filter = this.getAttribute('data-filter');
      let products = document.querySelectorAll('.product-card');
      products.forEach(card => {
        let cat = card.getAttribute('data-category');
        if(filter==='all' || cat===filter){
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
</script>
{% endblock %}
